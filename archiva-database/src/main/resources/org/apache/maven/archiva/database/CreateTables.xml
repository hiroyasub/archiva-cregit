<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="CreateTables">

<!-- 
METADATA_KEYS is the index table for all other tables
 -->
<statement id="initializeMetadataKeyTable">
    CREATE TABLE MetadataKeys (
      metadataKey     integer generated always as identity ( start with 1 ) primary key,
      groupId         varchar(100) not null,
      artifactId      varchar(100) not null,
      version         varchar(100) not null
    )
</statement>

<statement id="initializeRepositoryMetadataTable">
    CREATE TABLE RepositoryMetadata (
      metadataKey         integer not null,
      id                  integer generated always as identity ( start with 1 ) primary key,
      repositoryId        varchar(100) not null,
      latest              varchar(100) not null,
      release             varchar(100) not null,
      lastUpdated         integer not null,
      snapshotTimestamp   integer not null,
      snapshotBuildNumber integer not null,
      snapshotLocalCopy   char(1) not null,
      foreign key( metadataKey ) references MetadataKeys( metadataKey )
    )
</statement>

<statement id="initializeHealthMetadataTable">
    CREATE TABLE HealthMetadata (
      metadataKey         integer not null,
      id                  integer generated always as identity ( start with 1 ) primary key,     
      processId           varchar(100) not null,
      problemId           varchar(100) not null,
      message             varchar(8000) not null,
      foreign key( metadataKey ) references MetadataKeys( metadataKey )
    )
</statement>

<statement id="initializeVersionsMetadataTable">
    CREATE TABLE VersionMetadata (
      metadataKey         integer not null,
      id             integer generated always as identity ( start with 1 ) primary key,
      version        varchar(100) not null,
      foreign key( metadataKey ) references MetadataKeys( metadataKey )
    )
</statement>

</sqlMap>
<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one
  ~ or more contributor license agreements.  See the NOTICE file
  ~ distributed with this work for additional information
  ~ regarding copyright ownership.  The ASF licenses this file
  ~ to you under the Apache License, Version 2.0 (the
  ~ "License"); you may not use this file except in compliance
  ~ with the License.  You may obtain a copy of the License at
  ~
  ~   http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing,
  ~ software distributed under the License is distributed on an
  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~ KIND, either express or implied.  See the License for the
  ~ specific language governing permissions and limitations
  ~ under the License.
-->
<script id='redback/user-edit-tmpl' type='text/html'>
<div id="edit-user-details-pills">
  <ul id="edit_user_details_pills_headers" class="nav nav-pills" data-target="#edit-user-details-pills-content">
    <li class="active" id="user-view-detail-li">
      <a data-toggle="tab" href="#user-create-div">${$.i18n.prop('edit')}</a>
    </li>
    <li id="user-edit-roles-edit-li">
      <a data-toggle="tab" href="#user-edit-roles-edit">${$.i18n.prop('effective.roles.edit')}</a>
    </li>
  </ul>
  <div class="pill-content" id="edit-user-details-pills-content">
    <div id="user-create-div" class="active pill-pane">
      <div class="row-fluid">
        <div class="span8 columns">
          <form id="user-create" class="well form-horizontal" data-bind="submit: save">
            <fieldset id="user-create-fieldset">
              <div class="control-group">
                <label class="control-label" for="username">${$.i18n.prop('username')}</label>
                <div class="controls" id="username-div">
                  {{if $data.username.length>0}}
                    <span class="uneditable-input">${$data.username}</span>
                  {{else}}
                    <input type="text" id="username" name="username" size="30" class="required" data-bind="value: username"/>
                  {{/if}}
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="fullname">${$.i18n.prop('full.name')}</label>
                <div class="controls">
                  <input type="text" id="fullname" name="fullname" size="30" class="required" data-bind="value: fullName"/>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="password">${$.i18n.prop('password')}</label>
                <div class="controls">
                  <input type="password" id="password" name="password" class="required" data-bind="value: password"/>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="confirmPassword">${$.i18n.prop('confirm.password')}</label>
                <div class="controls">
                  <input type="password" id="confirmPassword" name="confirmPassword" data-bind="value: confirmPassword"/>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="email">${$.i18n.prop('email.address')}</label>
                <div class="controls">
                  <input type="text" id="email" name="email" class="required email" data-bind="value: email"/>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="validated">${$.i18n.prop('validated')}</label>
                <div class="controls">
                  <input type="checkbox" id="validated" name="validated" data-bind="checked: validated"/>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="locked">${$.i18n.prop('locked')}</label>
                <div class="controls">
                  <input type="checkbox" id="locked" name="locked" data-bind="checked: locked"/>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label" for="passwordChangeRequired">${$.i18n.prop('user.change.password.required')}</label>
                <div class="controls">
                  <input type="checkbox" id="passwordChangeRequired" name="passwordChangeRequired" data-bind="checked: passwordChangeRequired"/>
                </div>
              </div>
            </fieldset>
            <button data-bind="click: saveUser" class="btn" id="user-create-form-register-button">${$.i18n.prop('save')}</button>
            <button class="btn" id="user-create-form-cancel-button">${$.i18n.prop('cancel')}</button>
          </form>
        </div>
        <div class="span4 columns" id="user-edit-roles">
          <div id="user-edit-roles-view"></div>
        </div>
      </div>
    </div>

    <div id="user-edit-roles-edit" class="pill-pane">
      roles edit
    </div>
  </div>
</div>
</script>

<script id="user_view_roles_list_tmpl" type="text/html">
  <div class="page-header">
    <h3>${$.i18n.prop('effective.roles')}</h3>
  </div>
  <div>
    <ul>
      {{each $data.user.assignedRoles}}
        <li>${$value}</li>
      {{/each}}
    </ul>
  </div>
</script>

<script id="user_edit_roles_tmpl" type="text/html">

  <div>
    {{each $data.applicationRoles}}
      <div class="page-header">
        <h3>${$value.name}</h3>
      </div>
      <blockquote>
        <p>${$value.description}</p>
      </blockquote>
      <ul>
      {{each $value.globalRoles}}
        <li><input type="checkbox" value="${$value}" data-bind="checked: user.assignedRoles">&nbsp;${$value}</input></li>
      {{/each}}
      </ul>

      {{if roleTemplates}}
      <table class="bordered-table">
        <thead>
          <tr>
            <th>&nbsp;</th>
            {{each roleTemplates}}
              <th>${$value.namePrefix}</th>
            {{/each}}
          </tr>
        </thead>
        <tbody>
          {{each resources}}
            {{var curResource = $value}}
            <tr>
              <td>${curResource}</td>
              {{each roleTemplates}}
                <td><input type="checkbox" value="${$value.namePrefix}${$value.delimiter}${curResource}" data-bind="checked: user.assignedRoles"/></td>
              {{/each}}
            </tr>
          {{/each}}
        </tbody>
      </table>
      {{/if}}

    {{/each}}

    <button class="btn" data-bind="click:updateUserRoles">${$.i18n.prop('update')}</button>

  </div>
</script>

<script id='ko_usersGrid_grid' type='text/html'>
  <thead>
      <tr>
        {{each(i, columnDefinition) columns}}
          <th>${ columnDefinition.headerText }</th>
        {{/each}}
        <th>${$.i18n.prop('edit')}</th>
        <th>${$.i18n.prop('delete')}</th>
        <th>${$.i18n.prop('user.list.locked')}</th>
        <th>${$.i18n.prop('user.change.password.required')}</th>
      </tr>
  </thead>
  <tbody>
      {{each(i, row) itemsOnCurrentPage()}}
        <tr data-bind="css:{ 'modified': row.modified()}">
          {{each(j, columnDefinition) columns}}
          <td>${ typeof columnDefinition.rowText == 'function' ? columnDefinition.rowText(row) : row[columnDefinition.rowText] }</td>
          {{/each}}
          <td id="users-grid-user-id-${row.username()}">
            <a href="#" data-bind="click: function(){ editUserBox(row) }">
              <span class="btn btn-primary">
                <i class="icon-pencil icon-white"/>
              </span>
            </a>
          </td>
          {{if row.username()=="admin" || row.username()=="guest"}}
            <td></td>
          {{else}}
            <td>
              <a href="#" data-bind="click: function(){ deleteUser(row) }" id="users-grid-delete-${row.username()}">
                <span class="btn btn-danger">
                  <i class="icon-trash icon-white"/>
                </span>
              </a>
            </td>
          {{/if}}
          {{if row.username()=="admin"}}
            <td></td>
          {{else}}
            {{if row.locked()==true}}
              <td>
                <a href="#" data-bind="click: function(){ unlock(row) }"><img src="images/system-lock-screen-22-22.png"/></a>
              </td>
            {{else}}
              <td>
                <a href="#" data-bind="click: function(){ lock(row) }"><img src="images/weather-clear-22-22.png"/></a>
              </td>
            {{/if}}
          {{/if}}
          {{if row.username()=="admin"}}
            <td></td>
          {{else}}
            {{if row.passwordChangeRequired()==true}}
              <td>
                <a href="#" data-bind="click: function(){ passwordChangeRequire(row,false) }">
                  <img src="images/dialog-error-22-22.png"/>
                </a>
              </td>
            {{else}}
            <td>
              <a href="#" data-bind="click: function(){ passwordChangeRequire(row,true) }">
                <img src="images/weather-clear-22-22.png"/>
              </a>
            </td>
            {{/if}}
          {{/if}}
        </tr>
      {{/each}}
  </tbody>

</script>

<script id="usersGrid"  type="text/html">
    <div class="page-header">
      <h3><img src="images/system-users-32-32.png"/>${$.i18n.prop('users.list')}</h3>
    </div>
    <ul id="users-view-tabs" class="nav nav-tabs" data-target="#users-view-tabs-content">
      <li class="active" id="users-view-tabs-li-users-grid">
        <a data-toggle="tab" href="#users-view">${$.i18n.prop('users.grid.tab.title')}</a>
      </li>
      <li id="users-view-tabs-li-user-edit">
        <a data-toggle="tab" href="#createUserForm" id="users-view-tabs-li-user-edit-a">${$.i18n.prop('add')}</a>
      </li>
    </ul>
    <div id="users-view-tabs-content" class="tab-content">
      <div id="users-view" class="tab-pane">
        <button data-bind='click: sortByName'  class="btn">
            ${$.i18n.prop('users.sort.byname')}
        </button>
        <table class="table table-striped table-bordered" id="usersTable"
               data-bind="simpleGrid: gridViewModel,simpleGridTemplate:'ko_usersGrid_grid',pageLinksId:'usersPagination'">
        </table>
        <div id="usersPagination"></div>
      </div>
      <div id="createUserForm" class="tab-pane"></div>
    </div>
</script>

<script id="user-delete-warning-tmpl" type='text/html'>
    <div>
      <span class="label label-warning">${$.i18n.prop('warning.not.undone.operation')}</span>
    </div>
</script>




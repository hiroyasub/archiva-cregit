<model>
  <id>configuration</id>
  <name>Configuration</name>
  <description>
    Configuration for the Maven Repository Manager.
  </description>
  <defaults>
    <default>
      <key>package</key>
      <value>org.apache.maven.repository.configuration</value>
    </default>
  </defaults>
  <!-- TODO! break out subtypes such as <discovery> and create a list of blacklist, have multiple repositories -->
  <classes>
    <class rootElement="true" xml.tagName="configuration">
      <name>Configuration</name>
      <version>1.0.0</version>
      <fields>
        <field>
          <name>repositories</name>
          <version>1.0.0</version>
          <association>
            <type>RepositoryConfiguration</type>
            <multiplicity>*</multiplicity>
          </association>
        </field>
        <field>
          <name>indexPath</name>
          <version>1.0.0</version>
          <type>String</type>
          <description>
            The location of the Lucene index to use for the repository. The default is the .index subdirectory of
            the repository.
          </description>
        </field>
        <field>
          <name>minimalIndexPath</name>
          <version>1.0.0</version>
          <type>String</type>
          <description>
            The location of the reduced Lucene index to use for the repository. The default is the .small-index
            subdirectory of the repository.
          </description>
        </field>
        <field>
          <name>indexerCronExpression</name>
          <version>1.0.0</version>
          <type>String</type>
          <description>When to run the indexing mechanism. Default is every hour on the hour.</description>
          <defaultValue>0 0 * * * ?</defaultValue>
        </field>
        <field>
          <name>converterCronExpression</name>
          <version>1.0.0</version>
          <type>String</type>
          <description>When to run the converter mechanism. Default is every 4 hours, on the half hour.</description>
          <defaultValue>0 30 0/4 * * ?</defaultValue>
        </field>
        <field>
          <name>globalBlackListPatterns</name>
          <version>1.0.0</version>
          <type>String</type>
          <description>Blacklisted patterns in the discovery process</description>
        </field>
      </fields>
      <codeSegments>
        <codeSegment>
          <version>1.0.0</version>
          <code><![CDATA[
    public boolean isValid()
    {
        boolean valid = true;

        if ( indexPath == null )
        {
            valid = false;
        }
        else if ( getRepositories().isEmpty() )
        {
            valid = false;
        }
        else
        {
            for ( java.util.Iterator i = repositories.iterator(); i.hasNext() && valid; )
            {
                RepositoryConfiguration repository = (RepositoryConfiguration) i.next();

                valid = repository.isValid();
            }
        }
        return valid;
    }

    public RepositoryConfiguration getRepositoryById( String id )
    {
        for ( java.util.Iterator i = getRepositories().iterator(); i.hasNext(); )
        {
            RepositoryConfiguration repository = (RepositoryConfiguration) i.next();
            if ( repository.getId().equals( id ) )
            {
                return repository;
            }
        }
        return null;
    }
          ]]></code>
        </codeSegment>
      </codeSegments>
    </class>
    <class>
      <name>RepositoryConfiguration</name>
      <version>1.0.0</version>
      <fields>
        <field>
          <name>id</name>
          <version>1.0.0</version>
          <type>String</type>
          <required>true</required>
          <description>
            The repository identifier.
          </description>
        </field>
        <field>
          <name>name</name>
          <version>1.0.0</version>
          <type>String</type>
          <required>true</required>
          <description>
            The descriptive name of the repository.
          </description>
        </field>
        <field>
          <name>directory</name>
          <version>1.0.0</version>
          <type>String</type>
          <required>true</required>
          <description>
            The location of the repository to monitor.
          </description>
        </field>
        <field>
          <name>layout</name>
          <version>1.0.0</version>
          <type>String</type>
          <required>true</required>
          <description>
            The layout of the repository. Valid values are "default" and "legacy".
          </description>
          <!-- TODO: should be able to detect this from the repository (perhaps by metadata at the root) -->
          <defaultValue>default</defaultValue>
        </field>
        <field>
          <name>includeSnapshots</name>
          <version>1.0.0</version>
          <type>boolean</type>
          <description>Whether to include snapshot versions in the discovery process</description>
          <defaultValue>false</defaultValue>
        </field>
        <field>
          <name>indexed</name>
          <version>1.0.0</version>
          <type>boolean</type>
          <description>Whether to index the artifacts in this repository.</description>
          <defaultValue>true</defaultValue>
        </field>
        <field>
          <name>blackListPatterns</name>
          <version>1.0.0</version>
          <type>String</type>
          <description>Blacklisted patterns in the discovery process</description>
        </field>
      </fields>
      <codeSegments>
        <codeSegment>
          <version>1.0.0</version>
          <code><![CDATA[
    public RepositoryConfiguration()
    {
        this.indexed = false; // for webwork
    }

    public boolean isValid()
    {
        boolean valid = true;

        if ( directory == null )
        {
            valid = false;
        }

        return valid;
    }
          ]]></code>
        </codeSegment>
      </codeSegments>
    </class>
  </classes>
</model>


